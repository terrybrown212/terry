var app={init:function(){Dropzone.options.uploadDropzone={paramName:"upload",maxFilesize:window.AppConfig.max_upload_size/Math.pow(1024,2),dictDefaultMessage:window.AppConfig.lang.dropzone,error:function(e,a){this.defaultOptions.error(e,a.message)},totaluploadprogress:function(e){e=Math.round(e)+"%";$("#uploadProgess").css({width:e}).text(e)},queuecomplete:function(){$("#uploadProgess").css({width:"0%"}).text("")},success:function(e,a){$(e.previewElement).find(".dz-filename").children().html('<a href="'+a.url+'">'+e.name+"</a>")},timeout:0}},run:function(){$('[data-toggle="tooltip"]').tooltip(),$('[data-toggle="popover"]').popover(),$(".user-delete").click(app.modalDelete),$(".public-delete").click(app.modalDelete),$(".media-delete").click(app.mediaDelete),$(".publish-toggle").click(app.publishToggle),$(".refresh-token").click(app.refreshToken),$("#themes").mousedown(app.loadThemes),$(".checkForUpdatesButton").click(app.checkForUpdates),$(".bulk-selector").contextmenu(app.bulkSelect),$("#bulk-delete").click(app.bulkDelete),$(".tag-add").click(app.addTag),$(".tag-item").contextmenu(app.removeTag),$(".alert").not(".alert-permanent").fadeTo(1e4,500).slideUp(500,function(){$(".alert").slideUp(500)}),new ClipboardJS(".btn-clipboard"),new Plyr($("#player"),{ratio:"16:9"}),$(".footer").fadeIn(600),console.log("Application is ready.")},modalDelete:function(){$("#modalDelete-link").attr("href",$(this).data("link")),$("#modalDelete").modal("show")},publishToggle:function(){var e=$(this).data("id"),a=$(this),t=!1;$(this).data("published")?(t=a.hasClass("btn-outline-warning"),$.post(window.AppConfig.base_url+"/upload/"+e+"/unpublish",function(){a.data("published",!1).tooltip("dispose").attr("title",window.AppConfig.lang.publish).tooltip().removeClass(t?"btn-outline-warning":"btn-warning").addClass(t?"btn-outline-info":"btn-info").html('<i class="fas fa-check-circle"></i>'),$("#published_"+e).html('<span class="badge badge-danger"><i class="fas fa-times"></i></span>')})):(t=a.hasClass("btn-outline-info"),$.post(window.AppConfig.base_url+"/upload/"+e+"/publish",function(){a.data("published",!0).tooltip("dispose").attr("title",window.AppConfig.lang.hide).tooltip().removeClass(t?"btn-outline-info":"btn-info").addClass(t?"btn-outline-warning":"btn-warning").html('<i class="fas fa-times-circle"></i>'),$("#published_"+e).html('<span class="badge badge-success"><i class="fas fa-check"></i></span>')}))},mediaDelete:function(){var e=$(this).data("id"),a=$(this);$.post(window.AppConfig.base_url+"/upload/"+e+"/delete",function(){a.tooltip("dispose"),$("#media_"+e).fadeOut(200,function(){$(this).remove()})})},refreshToken:function(){var e=$(this).data("id");$.post(window.AppConfig.base_url+"/user/"+e+"/refreshToken",function(e){$("#token").val(e)})},loadThemes:function(e){e.preventDefault();var o=$("#themes");$.get(window.AppConfig.base_url+"/system/themes",function(e){o.empty(),$.each(e,function(e,a){var t=document.createElement("option");t.value=a,t.innerHTML=e,null===a&&(t.disabled=!0),o.append(t)})}),o.unbind("mousedown")},checkForUpdates:function(){$("#checkForUpdatesMessage").empty().html('<i class="fas fa-spinner fa-pulse fa-3x"></i>'),$("#doUpgradeButton").prop("disabled",!0),$.get(window.AppConfig.base_url+"/system/checkForUpdates?prerelease="+$(this).data("prerelease"),function(e){$("#checkForUpdatesMessage").empty().text(e.message),e.upgrade?$("#doUpgradeButton").prop("disabled",!1):$("#doUpgradeButton").prop("disabled",!0)})},bulkSelect:function(e){e.preventDefault(),$(this).toggleClass("bg-light").toggleClass("text-danger").toggleClass("bulk-selected");e=$("#bulk-delete");e.hasClass("disabled")&&e.removeClass("disabled")},bulkDelete:function(){$(".bulk-selected").each(function(e,a){$.post(window.AppConfig.base_url+"/upload/"+$(a).data("id")+"/delete",function(){$(a).fadeOut(200,function(){$(this).remove()})})}),$(this).addClass("disabled")},addTag:function(e){var a=$(this),t=a.clone().click(app.addTag).appendTo(a.parent()),o=$(document.createElement("input")).addClass("form-control form-control-verysm tag-input").attr("data-id",a.data("id")).attr("maxlength",32).css("width","90px").attr("onchange","this.value = this.value.toLowerCase();").keydown(function(e){return 13===e.keyCode?(app.saveTag.call($(this)),!1):32===e.keyCode?(t.click(),!1):void 0}).focusout(app.saveTag);a.off().removeClass("badge-success badge-light").html(o).children().focus()},saveTag:function(){var a=$(this).val(),t=$(this).data("id"),o=$(this).parent();if(""===a)return o.remove(),!1;$.ajax({type:"POST",url:window.AppConfig.base_url+"/tag/add"+window.location.search,data:{tag:a,mediaId:t},dataType:"json",success:function(e){e.limitReached?o.remove():o.replaceWith($(document.createElement("a")).addClass("badge badge-pill badge-light shadow-sm tag-item mr-1").attr("data-id",e.tagId).attr("data-media",t).attr("href",e.href).contextmenu(app.removeTag).text(a))}})},removeTag:function(e){e.preventDefault(),e.stopPropagation();var a=$(this);$.post(window.AppConfig.base_url+"/tag/remove",{tagId:a.data("id"),mediaId:a.data("media")},function(e){a.remove(),e.deleted&&$('#dropdown-tag-list > a[data-id="'+a.data("id")+'"]').remove()})}};app.init(),$(document).ready(app.run);